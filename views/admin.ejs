<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Admin Panel</title>
      <link rel="icon" href="/images/favicon-admin.png" type="image/png">
      <link href="/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="stylesheet" href="/node_modules/bootstrap-icons/font/bootstrap-icons.css">
      <link rel="stylesheet" href="/node_modules/@fortawesome/fontawesome-free/css/all.min.css">
      <link rel="stylesheet" href="/css/admin-styles.css">
   </head>
   <body class="bg-light d-flex flex-column min-vh-100">
      <div id="admin-data" 
         data-users='<%- JSON.stringify(users) %>'
         data-total-users="<%= totalUsers %>"
         data-creature-count="<%= creatureCount %>"
         data-deleted-creature-count="<%= deletedCreatureCount %>"
         style="display: none;">
      </div>
      <%- include('partials/nav') %>
      <main class="flex-grow-1 pb-5">
         <div class="container py-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
               <h2 class="mb-0">
                  <i class="fas fa-user-shield me-2 text-primary"></i>
                  Admin Panel
               </h2>
               <div class="d-flex">
                  <div class="input-group" style="width: 250px;">
                     <span class="input-group-text bg-white"><i class="fas fa-search"></i></span>
                     <input type="text" id="search-input" class="form-control" placeholder="Search users...">
                  </div>
                  <button class="btn btn-outline-secondary ms-2" data-bs-toggle="modal" data-bs-target="#adminInfoModal" title="Help">
                  <i class="fas fa-info-circle"></i>
                  </button>
               </div>
            </div>
            <div class="row mb-4 g-3">
               <div class="col-md-3">
                  <div class="card stats-card bg-white border-0 shadow-sm">
                     <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                           <div>
                              <h6 class="text-muted mb-2">Total Users</h6>
                              <div class="stats-value text-primary"><%= totalUsers %></div>
                           </div>
                           <div class="bg-primary bg-opacity-10 p-3 rounded">
                              <i class="fas fa-users text-primary"></i>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-md-3">
                  <div class="card stats-card bg-white border-0 shadow-sm">
                     <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                           <div>
                              <h6 class="text-muted mb-2">Characters</h6>
                              <div class="stats-value text-success"><%= creatureCount %></div>
                           </div>
                           <div class="bg-success bg-opacity-10 p-3 rounded">
                              <i class="fas fa-user-astronaut text-success"></i>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-md-3">
                  <div class="card stats-card bg-white border-0 shadow-sm">
                     <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                           <div>
                              <h6 class="text-muted mb-2">Deleted Chars</h6>
                              <div class="stats-value text-warning"><%= deletedCreatureCount %></div>
                           </div>
                           <div class="bg-warning bg-opacity-10 p-3 rounded">
                              <i class="fas fa-user-slash text-warning"></i>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-md-3">
                  <div class="card stats-card bg-white border-0 shadow-sm">
                     <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                           <div>
                              <h6 class="text-muted mb-2">Items per page</h6>
                              <select id="users-per-page" class="form-select form-select-sm" style="width: 80px;">
                                 <option value="5">5</option>
                                 <option value="10" selected>10</option>
                                 <option value="20">20</option>
                                 <option value="50">50</option>
                              </select>
                           </div>
                           <div class="bg-info bg-opacity-10 p-3 rounded">
                              <i class="fas fa-list-ol text-info"></i>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="card border-0 shadow-sm mb-4">
               <div class="card-body p-0">
                  <div class="table-responsive">
                     <table class="table table-hover mb-0">
                        <thead class="table-light">
                           <tr>
                              <th width="50">#</th>
                              <th>
                                 <div class="d-flex align-items-center">
                                    Username
                                    <span id="sort-username" class="ms-2" style="cursor: pointer;">
                                    <i class="fas fa-sort-alpha-down" id="sort-asc" title="Sort Ascending"></i>
                                    <i class="fas fa-sort-alpha-up-alt" id="sort-desc" title="Sort Descending" style="display: none;"></i>
                                    </span>
                                 </div>
                              </th>
                              <th width="150">Role</th>
                              <th width="280">Actions</th>
                           </tr>
                        </thead>
                        <tbody id="user-table-body">
                           <% users.forEach((user, index) => { %>
                           <tr data-user-id="<%= user.UserId %>">
                              <td><%= index + 1 %></td>
                              <td class="username-cell">
                                 <i class="fas fa-user-circle me-2 text-muted"></i>
                                 <%= user.UserName %>
                              </td>
                              <td>
                                 <div class="d-flex">
                                    <button class="btn btn-sm <%= user.admin ? 'btn-outline-danger' : 'btn-outline-success' %> role-toggle" 
                                       data-user-id="<%= user.UserId %>" 
                                       data-current-role="<%= user.admin ? 'admin' : 'user' %>">
                                    <% if (user.admin) { %>
                                    <i class="fas fa-user-shield me-1"></i> Admin
                                    <% } else { %>
                                    <i class="fas fa-user me-1"></i> User
                                    <% } %>
                                    </button>
                                 </div>
                              </td>
                              <td>
                                 <div class="d-flex gap-1">
                                    <a href="admin/edit-character?userName=<%= user.UserId %>" class="btn btn-action btn-outline-primary" title="Edit Characters">
                                    <i class="fas fa-user-edit"></i>
                                    </a>
                                    <a href="admin/add-deposit?userId=<%= user.UserId %>" class="btn btn-action btn-outline-success" title="Add Deposit">
                                    <i class="fas fa-coins"></i>
                                    </a>
                                    <a href="admin/add-item?userId=<%= user.UserId %>" class="btn btn-action btn-outline-info" title="Sending Items">
                                    <i class="fas fa-paper-plane"></i>
                                    </a>
                                    <a href="admin/add-vip?userId=<%= user.UserId %>" class="btn btn-action btn-outline-warning" title="VIP Management">
                                    <i class="fas fa-crown"></i>
                                    </a>
                                    <a href="admin/add-ban?userId=<%= user.UserId %>" class="btn btn-action btn-outline-danger" title="Ban Management">
                                    <i class="fas fa-gavel"></i>
                                    </a>
                                 </div>
                              </td>
                           </tr>
                           <% }) %>
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
            <nav aria-label="Page navigation">
               <ul class="pagination justify-content-center" id="pagination">
                  <!-- Пагинация будет здесь -->
               </ul>
            </nav>
         </div>
         <!-- Role Confirmation Modal -->
         <div class="modal fade" id="roleConfirmationModal" tabindex="-1" aria-labelledby="roleConfirmationModalLabel">
            <div class="modal-dialog">
               <div class="modal-content">
                  <div class="modal-header">
                     <h5 class="modal-title" id="roleConfirmationModalLabel">Confirm Role Change</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body" id="roleConfirmationModalBody">
                     <!-- Текст подтверждения будет здесь -->
                  </div>
                  <div class="modal-footer">
                     <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                     <button type="button" class="btn btn-primary" id="confirmRoleChange">Confirm</button>
                  </div>
               </div>
            </div>
         </div>
         <div id="toast-container" class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
            <div id="success-toast" class="toast align-items-center text-white bg-success border-0 d-none" role="alert" aria-live="assertive" aria-atomic="true">
               <div class="d-flex">
                  <div class="toast-body">
                     <i class="fas fa-check-circle me-2"></i>
                     <span id="success-message"></span>
                  </div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
               </div>
            </div>
            <div id="error-toast" class="toast align-items-center text-white bg-danger border-0 d-none" role="alert" aria-live="assertive" aria-atomic="true">
               <div class="d-flex">
                  <div class="toast-body">
                     <i class="fas fa-exclamation-circle me-2"></i>
                     <span id="error-message"></span>
                  </div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
               </div>
            </div>
         </div>
      </main>
      <%- include('partials/adminFooter') %>
      <%- include('partials/adminInfoModal') %>
      <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
      <script src="/js/admin-styles.js"></script>
   </body>
</html>