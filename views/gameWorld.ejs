<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Editing Game World Data</title>
      <link rel="icon" href="../images/favicon-admin.png" type="image/png">
      <link href="/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="stylesheet" href="/node_modules/bootstrap-icons/font/bootstrap-icons.css">
      <link rel="stylesheet" href="/node_modules/@fortawesome/fontawesome-free/css/all.min.css">
   </head>
   <body class="bg-light d-flex flex-column min-vh-100">
      <%- include('partials/nav') %>
      <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100"></div>
      <main class="flex-grow-1 pb-5">
         <div class="container py-4">
            <div id="content-container">
               <% if (gameWorldData.length === 0) { %>
               <div class="alert alert-info d-flex align-items-center" role="alert">
                  <i class="bi bi-info-circle-fill text-primary me-2 fs-4"></i>
                  <div>No data available to display.</div>
               </div>
               <% } else { %>
               <% gameWorldData.forEach((item, index) => { %>
               <!-- World Card -->
               <div class="card border-0 shadow-lg mb-4">
                  <!-- World Header -->
                  <div class="card-header bg-primary bg-gradient text-white d-flex justify-content-between align-items-center">
                     <div>
                        <h2 class="h4 mb-0"><i class="bi bi-globe-americas me-2"></i>Game Server: <%= item.WorldName %></h2>
                        <span class="badge bg-light text-primary"><i class="bi bi-hdd-network me-2"></i>Cluster ID: <%= item.WorldID %></span>
                     </div>
                     <div>
                        <button class="btn btn-outline-light btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#worldSettings<%= index %>">
                        <i class="bi bi-gear-fill me-1"></i>Manage
                        </button>
                        <button class="btn btn-outline-light btn-sm me-2" type="button" data-bs-toggle="modal" data-bs-target="#gameWorldInfoModal">
                        <i class="fas fa-info-circle me-1"></i>Info
                        </button>
                     </div>
                  </div>
                  <!-- World Stats -->
                  <div class="card-body">
                     <div class="row g-3">
                        <div class="col-md-4">
                           <div class="card h-100 border-0 shadow-sm">
                              <div class="card-body">
                                 <div class="d-flex align-items-center mb-3">
                                    <i class="bi bi-diagram-3 fs-3 text-primary me-3"></i>
                                    <div>
                                       <h5 class="mb-0">Cluster</h5>
                                       <span class="text-muted small">ID <%= item.WorldClusterID %></span>
                                    </div>
                                 </div>
                                 <hr>
                                 <div class="d-flex align-items-center">
                                    <i class="bi bi-people-fill fs-3 text-success me-3"></i>
                                    <div>
                                       <h5 class="mb-0">Crowdedness</h5>
                                       <div class="progress mt-2" style="height: 8px;">
                                          <div class="progress-bar bg-success" role="progressbar" 
                                             style="width: <%= item.Crowdedness * 10 %>%" 
                                             aria-valuenow="<%= item.Crowdedness %>" 
                                             aria-valuemin="0" 
                                             aria-valuemax="10"></div>
                                       </div>
                                       <span class="text-muted small"><%= item.Crowdedness %>/10</span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-md-4">
                           <div class="card h-100 border-0 shadow-sm">
                              <div class="card-body">
                                 <div class="d-flex align-items-center mb-3">
                                    <i class="bi bi-tags-fill fs-3 text-info me-3"></i>
                                    <div>
                                       <h5 class="mb-0">World Type</h5>
                                       <span class="text-muted small">Type <%= item.WorldType %></span>
                                    </div>
                                 </div>
                                 <hr>
                                 <div class="d-flex align-items-center">
                                    <i class="bi bi-controller fs-3 text-warning me-3"></i>
                                    <div>
                                       <h5 class="mb-0">Play Type</h5>
                                       <span class="text-muted small">Type <%= item.PlayType %></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-md-4">
                           <div class="card h-100 border-0 shadow-sm">
                              <div class="card-body">
                                 <div class="d-flex align-items-center mb-3">
                                    <i class="bi bi-power fs-3 <%= item.Usable ? 'text-success' : 'text-danger' %> me-3"></i>
                                    <div>
                                       <h5 class="mb-0">Status</h5>
                                       <span class="text-muted small"><%= item.Usable ? 'Active' : 'Inactive' %></span>
                                    </div>
                                 </div>
                                 <hr>
                                 <div class="d-flex align-items-center">
                                    <i class="bi bi-star-fill fs-3 <%= item.Recommendation ? 'text-warning' : 'text-secondary' %> me-3"></i>
                                    <div>
                                       <h5 class="mb-0">Recommendation</h5>
                                       <span class="text-muted small"><%= item.Recommendation ? 'Recommended' : 'Not recommended' %></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- World Settings -->
                  <div class="collapse" id="worldSettings<%= index %>">
                     <div class="card-body border-top bg-white">
                        <form class="update-game-world-form" method="POST" data-world-id="<%= item.WorldID %>">
                           <input type="hidden" name="WorldID" value="<%= item.WorldID %>">
                           <!-- Basic Settings -->
                           <div class="card mb-4 border-0 shadow-sm">
                              <div class="card-header bg-info bg-gradient text-white">
                                 <h5 class="mb-0"><i class="bi bi-sliders me-2"></i>Basic Settings</h5>
                              </div>
                              <div class="card-body">
                                 <div class="row g-3">
                                    <% const fields = [
                                       { label: 'World Cluster ID', field: 'WorldClusterID', value: item.WorldClusterID, type: 'number', icon: 'diagram-3', color: 'primary' },
                                       { label: 'World Name', field: 'WorldName', value: item.WorldName, type: 'text', icon: 'globe', color: 'primary' },
                                       { label: 'World Type', field: 'WorldType', value: item.WorldType, type: 'number', icon: 'tag-fill', color: 'primary' },
                                       { label: 'Play Type', field: 'PlayType', value: item.PlayType, type: 'number', icon: 'joystick', color: 'primary' },
                                       { label: 'Crowdedness', field: 'Crowdedness', value: item.Crowdedness, type: 'number', icon: 'people-fill', color: 'primary' }
                                       ]; %>
                                    <% fields.forEach((field) => { %>
                                    <div class="col-md-6">
                                       <label for="<%= field.field %>-<%= item.WorldID %>" class="form-label fw-bold">
                                       <i class="bi bi-<%= field.icon %> text-<%= field.color %> me-1"></i><%= field.label %>
                                       </label>
                                       <div class="input-group mb-2">
                                          <span class="input-group-text bg-<%= field.color %> bg-opacity-10 border-<%= field.color %>">
                                          <i class="bi bi-<%= field.icon %> text-<%= field.color %>"></i>
                                          </span>
                                          <input type="<%= field.type %>" id="<%= field.field %>-<%= item.WorldID %>" 
                                             name="<%= field.field %>" class="form-control border-<%= field.color %>" 
                                             value="<%= field.value %>">
                                          <button type="submit" class="btn btn-primary">
                                          <i class="bi bi-check-lg"></i> Update
                                          </button>
                                       </div>
                                       <p class="small text-muted mb-0">
                                          <% if (field.field === 'WorldClusterID') { %>
                                          Identifier of the world cluster to which this world belongs.
                                          <% } else if (field.field === 'WorldName') { %>
                                          The name of the game world. Max length: 16 characters.
                                          <% } else if (field.field === 'WorldType') { %>
                                          Type of game world (e.g., PvE, PvP, Role-play, etc.).
                                          <% } else if (field.field === 'PlayType') { %>
                                          Type of gameplay supported in this world.
                                          <% } else if (field.field === 'Crowdedness') { %>
                                          Level of world crowdedness (0-10).
                                          <% } %>
                                       </p>
                                    </div>
                                    <% }); %>
                                 </div>
                              </div>
                           </div>
                           <!-- Toggle Settings -->
                           <div class="card mb-4 border-0 shadow-sm">
                              <div class="card-header bg-purple bg-gradient text-white" style="background-color: #6f42c1;">
                                 <h5 class="mb-0"><i class="bi bi-toggle2-on me-2"></i>Toggle Settings</h5>
                              </div>
                              <div class="card-body">
                                 <div class="row g-3">
                                    <% const checkboxFields = [
                                       { label: 'Usable', field: 'Usable', value: item.Usable, icon: 'power', color: 'primary' },
                                       { label: 'Enterable', field: 'Enterable', value: item.Enterable, icon: 'door-open', color: 'primary' },
                                       { label: 'Character Creation Limit', field: 'CharacterCreationLimit', value: item.CharacterCreationLimit, icon: 'person-plus', color: 'primary' },
                                       { label: 'Character Of New Account Creation Limit', field: 'CharacterOfNewAccountCreationLimit', value: item.CharacterOfNewAccountCreationLimit, icon: 'person-add', color: 'primary' },
                                       { label: 'Brand New', field: 'BrandNew', value: item.BrandNew, icon: 'star-fill', color: 'primary' },
                                       { label: 'Recommendation', field: 'Recommendation', value: item.Recommendation, icon: 'hand-thumbs-up-fill', color: 'primary' }
                                       ]; %>
                                    <% checkboxFields.forEach((field) => { %>
                                    <div class="col-md-6">
                                       <div class="form-check form-switch ps-0">
                                          <div class="d-flex align-items-center">
                                             <i class="bi bi-<%= field.icon %> text-<%= field.color %> me-2 fs-5"></i>
                                             <input class="form-check-input ms-0 me-2" type="checkbox" role="switch" 
                                                id="<%= field.field %>-<%= item.WorldID %>" name="<%= field.field %>" 
                                                value="1" <%= field.value ? 'checked' : '' %> style="width: 3em; height: 1.5em;">
                                             <label class="form-check-label fw-bold" for="<%= field.field %>-<%= item.WorldID %>">
                                             <%= field.label %>
                                             </label>
                                          </div>
                                          <p class="small text-muted mb-0 ps-4">
                                             <% if (field.field === 'Usable') { %>
                                             World is available for play.
                                             <% } else if (field.field === 'Enterable') { %>
                                             Players can enter this world.
                                             <% } else if (field.field === 'CharacterCreationLimit') { %>
                                             Character creation limits exist.
                                             <% } else if (field.field === 'CharacterOfNewAccountCreationLimit') { %>
                                             Creation limits for new accounts.
                                             <% } else if (field.field === 'BrandNew') { %>
                                             World is marked as new.
                                             <% } else if (field.field === 'Recommendation') { %>
                                             World is recommended to players.
                                             <% } %>
                                          </p>
                                       </div>
                                    </div>
                                    <% }); %>
                                 </div>
                                 <div class="d-flex justify-content-end mt-3">
                                    <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save-fill me-1"></i>Save All Settings
                                    </button>
                                 </div>
                              </div>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
               <!-- Cluster Settings -->
               <div class="card border-0 shadow-lg mb-4">
                  <div class="card-header bg-primary bg-gradient text-white">
                     <h3 class="h5 mb-0"><i class="bi bi-server me-2"></i>Cluster Settings</h3>
                  </div>
                  <div class="card-body">
                     <% gameWorldClusterData.forEach((cluster) => { %>
                     <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-info bg-gradient text-dark">
                           <h5 class="mb-0"><i class="bi bi-hdd-network me-2"></i>Cluster ID: <%= cluster.WorldClusterID %></h5>
                        </div>
                        <div class="card-body">
                           <form class="update-cluster-form" method="POST" data-cluster-id="<%= cluster.WorldClusterID %>">
                              <div class="row g-3">
                                 <% const clusterFields = [
                                    { label: 'Game Public IPv4 Address', field: 'GamePublicIPv4Address', value: cluster.GamePublicIPv4Address, type: 'text', icon: 'globe2', color: 'primary' },
                                    { label: 'Game Public Port', field: 'GamePublicPort', value: cluster.GamePublicPort, type: 'number', icon: 'plug', color: 'primary' },
                                    { label: 'Max Player Count', field: 'MaxPlayerCount', value: cluster.MaxPlayerCount, type: 'number', icon: 'people-fill', color: 'primary' },
                                    { label: 'Max Waiting Count', field: 'MaxWaitingCount', value: cluster.MaxWaitingCount, type: 'number', icon: 'clock-history', color: 'primary' },
                                    { label: 'Game Internal IPv4 Address', field: 'GameInternalIPv4Address', value: cluster.GameInternalIPv4Address, type: 'text', icon: 'lan', color: 'primary' },
                                    { label: 'Game Internal Port', field: 'GameInternalPort', value: cluster.GameInternalPort, type: 'number', icon: 'ethernet', color: 'primary' }
                                    ]; %>
                                 <% clusterFields.forEach((field) => { %>
                                 <div class="col-md-6">
                                    <label for="<%= field.field %>-<%= cluster.WorldClusterID %>" class="form-label fw-bold">
                                    <i class="bi bi-<%= field.icon %> text-<%= field.color %> me-1"></i><%= field.label %>
                                    </label>
                                    <div class="input-group mb-2">
                                       <span class="input-group-text bg-<%= field.color %> bg-opacity-10 border-<%= field.color %>">
                                       <i class="bi bi-<%= field.icon %> text-<%= field.color %>"></i>
                                       </span>
                                       <input type="<%= field.type %>" id="<%= field.field %>-<%= cluster.WorldClusterID %>" 
                                          name="<%= field.field %>" class="form-control border-<%= field.color %>" 
                                          value="<%= field.value %>">
                                       <button type="submit" class="btn btn-primary">
                                       <i class="bi bi-check-lg"></i> Update
                                       </button>
                                    </div>
                                    <p class="small text-muted mb-0">
                                       <% if (field.field === 'GamePublicIPv4Address') { %>
                                       Public IPv4 address for player connections.
                                       <% } else if (field.field === 'GamePublicPort') { %>
                                       Public port for player connections.
                                       <% } else if (field.field === 'MaxPlayerCount') { %>
                                       Maximum players allowed in this world.
                                       <% } else if (field.field === 'MaxWaitingCount') { %>
                                       Maximum players allowed to wait in queue.
                                       <% } else if (field.field === 'GameInternalIPv4Address') { %>
                                       Internal IPv4 address for server network.
                                       <% } else if (field.field === 'GameInternalPort') { %>
                                       Internal port for server network.
                                       <% } %>
                                    </p>
                                 </div>
                                 <% }); %>
                                 <input type="hidden" name="WorldClusterID" value="<%= cluster.WorldClusterID %>">
                                 <div class="col-12 mt-3">
                                    <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-save-fill me-1"></i>Save All Cluster Settings
                                    </button>
                                 </div>
                              </div>
                           </form>
                        </div>
                     </div>
                     <% }); %>
                  </div>
               </div>
               <% }); %>
               <% } %>
            </div>
         </div>
      </main>
      <%- include('partials/adminFooter') %>
      <%- include('partials/gameWorldInfoModal') %>
      <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
      <script src="/js/admin-game-world.js"></script>
      <script>
         // Initialize message from server if exists
         <% if (message) { %>
         document.addEventListener('DOMContentLoaded', function() {
             showToast('<%= message %>');
         });
         <% } %>
      </script>
   </body>
</html>